{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Register for Beta{% endblock title %}

{% block content %}
<div class="page-title text-xs-center color-white">
    <svg class="icon__table" role="img">
        <use xlink:href="{% static 'img/svg/icons.svg' %}#opencraft_icon_table-01"/>
    </svg>
    <h1 class="page-title__text">Host</h1>
    <p class="page-title__catchline text-xs-center h4">
        Your own production instance of Open edX<br>
        Pre-installed &amp; ready to use.
    </p>
</div>

<div class="row small-collapse page-content clearfix" ng-app="RegistrationApp">
    <div class="page-content__inner small-12 medium-10 medium-offset-1 columns background-white">
        {% with application=form.instance %}

            <div id="form" class="page-content__header small-10 small-offset-1 columns">
                {% if application.pk %}
                    {% if messages %}
                        {% for message in messages %}
                            <div class="box-alert background-cyan-very-very-dark-desaturated color-white">
                                <p class="box-alert__content">
                                    {{ message }}
                                </p>
                            </div>
                        {% endfor %}
                    {% endif %}
                    {% if application.status == 'pending' %}
                        <div class="box-alert background-cyan-very-very-dark-desaturated color-white">
                            <p class="box-alert__content">
                                Thank you for applying for the OpenCraft beta. We
                                will contact you shortly.
                            </p>
                        </div>
                    {% elif application.status == 'accepted' %}
                        <div class="box-alert background-cyan-very-very-dark-desaturated color-white">
                            <p class="box-alert__content">
                                Thank you for applying for the OpenCraft beta. Your
                                application has been accepted!
                            </p>
                        </div>
                    {% elif application.status == 'rejected' %}
                        <div class="box-alert background-cyan-very-very-dark-desaturated color-white">
                            <p class="box-alert__content">
                                Sorry, your application has been rejected.
                            </p>
                        </div>
                    {% endif %}
                    {% if not form.instance.email_addresses_verified %}
                        <div class="box-alert background-cyan-very-very-dark-desaturated color-white">
                            <p class="box-alert__content">
                                Application status: pending email confirmation. You
                                should receive verification emails at both of the
                                email addresses you provided.  Please click on the
                                links in the emails to confirm your registration.
                                Be sure to check your spam folder if you can't find
                                them, or <a href="mailto:contact@opencraft.com">contact us</a>.
                            </p>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="box-alert background-cyan-very-very-dark-desaturated color-white">
                        <p class="box-alert__content">
                            This is the application form for the beta of the
                            self-service hosting offered by OpenCraft.<br>
                            For enterprise or institutional offerings,
                            <a href="mailto:contact@opencraft.com">contact us</a>.
                        </p>
                    </div>
                {% endif %}
            </div>

            {% include "registration/registration_form.html" %}

        {% endwith %}
    </div>
</div>
{% endblock content %}

{% block body_js %}
<script src="{% static "djng/js/django-angular.min.js" %}"></script>
<script src="{% static "external/js/icheck.min.js" %}"></script>
<script src="{% static "external/js/zxcvbn.js" %}"></script>
<script src="{% static "js/src/registration.js" %}"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/file-uploader/5.15.0/fine-uploader.min.js"></script>
  <!-- Cookies.js, so we can get the CSRFToken cookie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.min.js" charset="utf-8"></script>
  <script>
    var default_concurrent_chunked_uploader = new qq.FineUploader({
      debug: true,
        multiple: false,
      element: document.getElementById('logo-uploader'),
      request: {
        // endpoint: '{% url 'django_fine_uploader:upload' %}',
        endpoint: '{% url 'registration:images-upload' %}',
        customHeaders: {
          'X-CSRFToken': Cookies.get('csrftoken')
        }
      },
       //  validation: {
       //      acceptFiles: true,
       //      allowedExtensions: ['png','jpg','jpeg'],
       //      image: {
       //          maxHeight: 600,
       //          maxWidth: 600,
       //          minHeight: 10,
       //          minWidth: 10
       //      }
       //       //stopOnFirstInvalidFile: false
       //  },
/*
        form: {
            element: "registration-form",
            autoUpload: false,
            interceptSubmit: true
        },
*/

      chunking: {
/*
        enabled: true,

        concurrent: {
            enabled: true
        },
*/
        enabled: false,

        concurrent: {
            enabled: false
        },
        success: {
          // endpoint: '{% url 'django_fine_uploader:upload' %}?done'
          endpoint: '{% url 'registration:images-upload' %}?done'
        }
      }
    });
  </script>

{% endblock body_js %}


{% block head_js %}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/file-uploader/5.13.0/fine-uploader-gallery.min.css" rel="stylesheet">
  <script type="text/template" id="qq-template">
    <div class="qq-uploader-selector qq-uploader qq-gallery" qq-drop-area-text="Drop a file here">
      <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
        <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
      </div>
      <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
        <span class="qq-upload-drop-area-text-selector"></span>
      </div>
      <div class="qq-upload-button-selector qq-upload-button">
        <div>Upload a logo</div>
      </div>
      <span class="qq-drop-processing-selector qq-drop-processing">
        <span>Processing dropped files...</span>
        <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
      </span>
      <ul class="qq-upload-list-selector qq-upload-list" role="region" aria-live="polite" aria-relevant="additions removals">
        <li>
          <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
          <div class="qq-progress-bar-container-selector qq-progress-bar-container">
            <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-progress-bar-selector qq-progress-bar"></div>
          </div>
          <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
          <div class="qq-thumbnail-wrapper">
            <img class="qq-thumbnail-selector" qq-max-size="120" qq-server-scale>
          </div>
          <button type="button" class="qq-upload-cancel-selector qq-upload-cancel">X</button>
          <button type="button" class="qq-upload-retry-selector qq-upload-retry">
            <span class="qq-btn qq-retry-icon" aria-label="Retry"></span>
              Retry
          </button>

          <div class="qq-file-info">
            <div class="qq-file-name">
              <span class="qq-upload-file-selector qq-upload-file"></span>
              <span class="qq-edit-filename-icon-selector qq-btn qq-edit-filename-icon" aria-label="Edit filename"></span>
            </div>
            <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
            <span class="qq-upload-size-selector qq-upload-size"></span>
            <button type="button" class="qq-btn qq-upload-delete-selector qq-upload-delete">
              <span class="qq-btn qq-delete-icon" aria-label="Delete"></span>
            </button>
            <button type="button" class="qq-btn qq-upload-pause-selector qq-upload-pause">
              <span class="qq-btn qq-pause-icon" aria-label="Pause"></span>
            </button>
            <button type="button" class="qq-btn qq-upload-continue-selector qq-upload-continue">
              <span class="qq-btn qq-continue-icon" aria-label="Continue"></span>
            </button>
          </div>
        </li>
      </ul>

      <dialog class="qq-alert-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <div class="qq-dialog-buttons">
          <button type="button" class="qq-cancel-button-selector">Close</button>
        </div>
      </dialog>

      <dialog class="qq-confirm-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <div class="qq-dialog-buttons">
          <button type="button" class="qq-cancel-button-selector">No</button>
          <button type="button" class="qq-ok-button-selector">Yes</button>
        </div>
      </dialog>

      <dialog class="qq-prompt-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <input type="text">
        <div class="qq-dialog-buttons">
          <button type="button" class="qq-cancel-button-selector">Cancel</button>
          <button type="button" class="qq-ok-button-selector">Ok</button>
        </div>
      </dialog>
    </div>
</script>

{% endblock head_js %}
